<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Lease Registration Page</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css" rel="stylesheet" />
</head>
<body>
    <div class="container-fluid mt-4">
        <h2>Test Lease Registration Page</h2>
        <p>This page tests the dropdowns from lease_registration.php</p>
        
        <div class="card">
            <div class="card-header">
                <h5>Dropdown Tests</h5>
            </div>
            <div class="card-body">
                <div class="row">
                    <div class="col-md-6">
                        <div class="mb-3">
                            <label for="client_test" class="form-label">Client Dropdown</label>
                            <select class="form-control select2-client" id="client_test" name="client_test">
                                <option value="">Search and select client...</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="col-md-6">
                        <div class="mb-3">
                            <label for="recovery_test" class="form-label">Recovery Person Dropdown</label>
                            <select class="form-control select2-recovery" id="recovery_test" name="recovery_test">
                                <option value="">Search and select recovery person...</option>
                            </select>
                        </div>
                    </div>
                </div>
                
                <div class="row">
                    <div class="col-md-6">
                        <div class="mb-3">
                            <label for="product_test" class="form-label">Product Dropdown</label>
                            <select class="form-control select2-product" id="product_test" name="product_test">
                                <option value="">Search and select product...</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="col-md-6">
                        <div class="mb-3">
                            <label for="outlet_test" class="form-label">Outlet Dropdown</label>
                            <select class="form-control select2-master" id="outlet_test" name="outlet_test" data-type="outlet">
                                <option value="">Select Outlet</option>
                            </select>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>
    <!-- DON'T include master_data_dropdowns.js - we'll initialize dropdowns manually -->
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Initialize Select2 for Client dropdowns (.select2-client)
            $('.select2-client').select2({
                placeholder: "Search and select client...",
                allowClear: true,
                ajax: {
                    url: window.location.pathname.split('/').slice(0, -1).join('/') + '/lease_registration.php',
                    dataType: 'json',
                    delay: 250,
                    data: function (params) {
                        return {
                            action: 'search_master',
                            type: 'client',
                            q: params.term || ''
                        };
                    },
                    processResults: function (data) {
                        if (!data) return { results: [] };
                        var results = data.results || data;
                        return { results: Array.isArray(results) ? results : [] };
                    }
                },
                minimumInputLength: 0
            });
            
            // Initialize Select2 for Recovery Officer dropdowns (.select2-recovery)
            $('.select2-recovery').select2({
                placeholder: "Search and select recovery person...",
                allowClear: true,
                ajax: {
                    url: window.location.pathname.split('/').slice(0, -1).join('/') + '/lease_registration.php',
                    dataType: 'json',
                    delay: 250,
                    data: function (params) {
                        return {
                            action: 'search_master',
                            type: 'recovery_person',
                            q: params.term || ''
                        };
                    },
                    processResults: function (data) {
                        if (!data) return { results: [] };
                        var results = data.results || data;
                        return { results: Array.isArray(results) ? results : [] };
                    }
                },
                minimumInputLength: 0
            });
            
            // Initialize Select2 for Product dropdowns (.select2-product)
            $('.select2-product').select2({
                placeholder: "Search and select product...",
                allowClear: true,
                ajax: {
                    url: window.location.pathname.split('/').slice(0, -1).join('/') + '/lease_registration.php',
                    dataType: 'json',
                    delay: 250,
                    data: function (params) {
                        return {
                            action: 'search_master',
                            type: 'product',
                            q: params.term || ''
                        };
                    },
                    processResults: function (data) {
                        if (!data) return { results: [] };
                        var results = data.results || data;
                        return { results: Array.isArray(results) ? results : [] };
                    }
                },
                minimumInputLength: 0
            });
            
            // Initialize Select2 for Outlet dropdown (.select2-master)
            $('.select2-master').select2({
                placeholder: "Select...",
                allowClear: true,
                ajax: {
                    url: window.location.pathname.split('/').slice(0, -1).join('/') + '/lease_registration.php',
                    dataType: 'json',
                    delay: 250,
                    data: function (params) {
                        return {
                            action: 'search_master',
                            type: $(this).data('type') || 'outlet',
                            q: params.term || ''
                        };
                    },
                    processResults: function (data) {
                        if (!data) return { results: [] };
                        var results = data.results || data;
                        return { results: Array.isArray(results) ? results : [] };
                    }
                },
                minimumInputLength: 0
            });
        });
    </script>
</body>
</html>